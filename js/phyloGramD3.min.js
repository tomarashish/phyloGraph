dendroGram=function(){function t(t){t.each(function(t){K=this,T=v(t),e(T)})}function e(t){if(it(0,t),"linear"==Q.treeType){D=600,L=500,R=200,P=20,S=d3.layout.cluster().size([L,D-300]).children(function(t){return t.branchset}).value(function(t){return t.length}).separation(function(t,e){return t.parent==e.parent,1});var e=50*d3.max(lt);S=S.size([e,D-350])}"radial"==Q.treeType&&(I=450,N=I-160,D=2*I,L=2*I,R=200,P=20,S=d3.layout.cluster().size([360,N]).children(function(t){return t.branchset}).value(function(t){return 1}).sort(function(t,e){return t.value-e.value||d3.ascending(t.length,e.length)}).separation(function(t,e){return 1})),w=S.nodes(t),M=S.links(w),O=d3.select("#show-length input").on("change",l),j=setTimeout(function(){O.property("checked",!0).each(l)},300),"radial"==Q.treeType&&y(T,T.length=0,N/g(T));if(d3.select(K).select("svg").remove(),E=d3.select(K).append("svg").attr("width","100%").attr("height","100%").attr("viewBox","0 0 800 700").attr("preserveAspectRation","xMinYMid").call(rt).append("g").attr("transform",function(t){return"linear"==Q.treeType?"translate(40,40)":"radial"==Q.treeType?"translate("+I+","+I+")":void 0}),G=E.append("g").attr("class","link-extensions").selectAll("path").data(M.filter(function(t){return!t.target.children})).enter().append("path").each(function(t){t.target.linkExtensionNode=this}).attr("d",function(t){return"radial"==Q.treeType?f(t.target.x,t.target.y,t.target.x,N):"linear"==Q.treeType?p(t.target.x,t.target.y,t.target.x,t.target.y):void 0}).style("fill","none").style("stroke",function(t){return $(t.target.name)}).style("stroke-width",function(t){return"linear"==Q.treeType?1==Q.weightLinks?at(t.target.length):3:"radial"==Q.treeType?2:void 0}).style("stoke-opacity","0.25").style("stroke-linecap","round").style("stroke-dasharray",function(t){return"linear"==Q.treeType?3.5:"radial"==Q.treeType?0:void 0}),U=E.append("g").attr("class","links").selectAll("path").data(M).enter().append("path").each(function(t){t.target.linkNode=this}).attr("d",function(t){return"radial"==Q.treeType?f(t.source.x,t.source.y,t.target.x,t.target.y):"linear"==Q.treeType?p(t.source.x,t.source.y,t.target.x,t.target.y):void 0}).style("fill","none").style("stroke",function(t){return $(t.target.name)}).style("stroke-linecap","round").style("opacity",".7").style("stroke-width",function(t){return"linear"==Q.treeType?1==Q.weightLinks?at(t.target.length):3:"radial"==Q.treeType?4:void 0}),"linear"==Q.treeType){X=E.selectAll(".node").data(w).enter().append("g").attr("class",function(t){return t.children?0==t.depth?"root-node":"inner-node":"leaf-node"}).attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),1==Q.subTree&&(E.selectAll(".inner-node").on("click",a),E.selectAll(".leaf-node").on("click",n)),1==Q.collapseTree&&(E.selectAll(".inner-node").on("click",b),E.selectAll(".leaf-node").on("click",n)),z=E.selectAll(".leaf-node").append("circle").attr("r",function(t){return 1==Q.nodeSize?30*t.value:2.5}).style("stroke",function(t){return $(t.name)}).style("stroke-width","1px").style("fill-opacity","0.8").style("fill",function(t){return $(t.name)});var r;"rect"==Q.nodeShape&&(r=E.selectAll(".inner-node").append("rect").attr("width",3).attr("height",2)),("circle"==Q.nodeShape||1==Q.subTree||1==Q.collapseTree)&&(r=E.selectAll(".inner-node").append("circle").attr("r",3)),Q.nodeShape&&r.style("stroke",function(t){return $(t.name)}).style("stroke-width","1px").style("fill-opacity","0.8").style("fill",function(t){return $(t.name)}),X.append("text").attr("dx",function(t){return t.children?-5:4}).attr("dy",function(t){return t.children||1!=Q.linkValue?void 0:8}).attr("text-anchor",function(t){return t.children?"end":"start"}).style("font-size","7px").style("fill","#000").text(function(t){if(t.children){if(1==Q.linkValue)return t.length;if(1==Q.linkName)return t.name}})}Y=E.append("g").attr("class","labels").selectAll("text").data(w.filter(function(t){return!t.children})).enter().append("text").attr("dy",".35em").attr("transform",function(t){return"linear"==Q.treeType?"translate(257,"+(t.x+3)+")":"radial"==Q.treeType?"rotate("+(t.x-90)+")translate("+(N+5)+",0)"+(t.x<180,""):void 0}).style("text-anchor",function(t){return"start"}).style("font-size","8px").style("fill",function(t){return $(t.name)}).style("font-weight","bold").text(function(t){return t.name}).each(function(t){var e=this.getBBox();Z=Math.max(e.width,Z)}),"linear"==Q.treeType&&(J=E.append("g").attr("class","labels-rect").selectAll("rect").data(w.filter(function(t){return!t.children})).enter().append("rect").attr("y",-5).attr("width",Z+5).attr("height",15).attr("transform",function(t){return"translate(255,"+t.x+")"}).style("fill",function(t){return $(t.name)}).style("opacity","0.3")),_&&m(_),C&&s(C),q&&o(q),B&&c(),H&&u(H),F&&i()}function n(){e(T)}function a(t){e(t)}function r(t,e){null!=t.length&&(e+=115*t.length),t.y=e,t.children&&t.children.forEach(function(t){r(t,e)})}function l(){var t=this.checked;"linear"==Q.treeType&&(t&&r(w[0],100),t||(w=S.nodes(T)),d3.transition().duration(750).each(function(){G.transition().attr("d",function(e){return p(e.target.x,e.target.y,e.target.x,t?250:e.target.y)}),U.transition().attr("d",function(t){return p(t.source.x,t.source.y,t.target.x,t.target.y)}),X.transition().attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),1==Q.noLinkExtend&&(G.transition().attr("d",function(e){return p(e.target.x,e.target.y,e.target.x,t?e.target.y:e.target.y)}),Y.transition().attr("transform",function(t){return"translate("+(t.y+5)+","+(t.x+3)+")"}),J.transition().attr("transform",function(t){return"translate("+(t.y+3)+","+t.x+")"}),V.transition().attr("transform",function(t){return"translate(250,"+t.x+")"}))})),"radial"==Q.treeType&&(console.log("change"),d3.transition().duration(750).each(function(){G.transition().attr("d",function(e){return f(e.target.x,t?e.target.radius:e.target.y,e.target.x,N)}),U.transition().attr("d",function(e){return f(e.source.x,t?e.source.radius:e.source.y,e.target.x,t?e.target.radius:e.target.y)})}))}function i(){function t(t){console.log(this);d3.select(this).selectAll("path").data(s.nodes(t.parent)).enter().append("path").attr("d",o).style("opacity","0.7").style("fill",function(t){return i(t.name)})}var e=30,n=30,a=Math.min(e,n)/2,r=d3.scale.linear().range([0,2*Math.PI]),l=d3.scale.linear().range([0,a]),i=d3.scale.category20(),s=d3.layout.partition().value(function(t){return 1}),o=d3.svg.arc().startAngle(function(t){return Math.max(0,Math.min(2*Math.PI,r(t.x)))}).endAngle(function(t){return Math.max(0,Math.min(2*Math.PI,r(t.x+t.dx)))}).innerRadius(function(t){return Math.max(0,l(t.y))}).outerRadius(function(t){return Math.max(0,l(t.y+t.dy))});E.selectAll(".leaf-node").on("click",t)}function s(t){var e=10,n=d3.layout.pie().sort(null).value(function(t){return t.value}),a=d3.svg.arc().outerRadius(function(t){return e}).startAngle(function(t){return isNaN(t.startAngle)?0:t.startAngle}).endAngle(function(t){return isNaN(t.endAngle)?0:t.endAngle}),r=d3.nest().key(function(t){return t.name}).map(t),l=[{value:0}];if("radial"==Q.treeType){var i=E.selectAll("g.node").data(w.filter(function(t){return!t.children})).enter().append("g").attr("transform",function(t){return"rotate("+(t.x-90)+")translate("+(N+100)+",0)"});i.each(function(t){d3.select(this).selectAll("path").data(function(t){return n(data)}).enter().append("path").attr("d",a).style("opacity","0.7").style("fill",function(t,e){return $(e)})})}if("linear"==Q.treeType){newHeight=100*d3.max(lt),S=S.size([newHeight,D-350]),w=S.nodes(T),M=S.links(w),d3.transition().duration(750).each(function(){G.transition().attr("d",function(t){return p(t.target.x,t.target.y,t.target.x,t.target.y)}),U.transition().attr("d",function(t){return p(t.source.x,t.source.y,t.target.x,t.target.y)}),X.transition().attr("transform",function(t){return"translate("+t.y+","+t.x+")"}),J.transition().attr("transform",function(t){return"translate(265,"+t.x+")"}),Y.transition().attr("transform",function(t){return"translate(267,"+t.x+")"})});var i=E.selectAll(".root-node, .leaf-node, .inner-node");i.each(function(t){d3.select(this).selectAll("path").data(function(t){return n(r[t.name]?r[t.name]:l)}).enter().append("path").attr("d",a).style("opacity","0.7").style("fill",function(t,e){return $(e)})})}}function o(t){var e=40,n=13.5;et.domain([0,nt-1,d3.max(t,function(t){return t.value})]);var a=t.map(function(t){return t.name}),r=d(a),l=(E.append("g").selectAll(".termlableg").data(r).enter().append("text").text(function(t,e){return"sample"+(e+1)}).attr("x",function(t,n){return n*e+(290+e)}).attr("y",250).style("text-anchor","start").style("font-size","10px").attr("transform",function(t,n){return"rotate(-45,"+(n*e+e)+",100)"}).attr("class","termLabel mono"),E.selectAll(".cellg").data(t).enter().append("rect").attr("x",function(t){return Z+270+(t.sample-1)*(e+1)}).attr("y",function(t,e){return 5+r.indexOf(t.name)*(n+3)}).attr("class",function(t){return 0==t.specificity?"cell cell-border cr"+(t.name-1)+" cc"+(t.sample-1):"cell-specific cell cell-border cr"+(t.name-1)+" cc"+(t.sample-1)}).attr("width",e).attr("height",n).style("fill",tt[0]));l.transition().duration(500).style("fill",function(t){return et(Math.log2(t.value))})}function d(t){return t.filter(function(t,e,n){return!e||t!=n[e-1]})}function u(t){var e=t.map(function(t){return t.sample}),n=d(e),a=d3.scale.linear().domain([0,50]).range([0,100]),r=10;E.selectAll(".domain-line").data(n).enter().append("line").attr("x1",Z+338).attr("x2",Z+670).attr("y1",function(t,e){return 12+e*(r+2)}).attr("y2",function(t,e){return 12+e*(r+2)}).style("stroke","lightgrey").style("stroke-width",2),E.selectAll(".domain-rect").data(t).enter().append("rect").attr("x",function(t){return Z+350+(t.domain-1)*a(t.start)}).attr("y",function(t){return 7+n.indexOf(t.sample)*(r+2)}).attr("width",function(t){return a(t.end)-a(t.start)}).attr("height",r).attr("rx",3).attr("ry",3).style("stroke","#608186").style("stroke-width",1).style("fill","#D25640")}function c(){var t=[{domain:1,sample:1,start:0,end:6,type:"rect"},{domain:2,sample:1,start:10,end:19,type:"rect"},{domain:3,sample:1,start:20,end:28,type:"rect"},{domain:4,sample:1,start:24,end:36,type:"elips"},{domain:2,sample:2,start:7,end:15,type:"rect"},{domain:3,sample:2,start:18,end:24},{domain:3,sample:2,start:25,end:27},{domain:1,sample:3,start:4,end:9},{domain:2,sample:3,start:10,end:15},{domain:3,sample:3,start:20,end:25,value:90.23},{domain:3,sample:3,start:27,end:29},{domain:4,sample:3,start:30,end:40},{domain:3,sample:4,start:20,end:23},{domain:4,sample:4,start:24,end:30},{domain:1,sample:5,start:1,end:5},{domain:3,sample:5,start:21,end:24},{domain:3,sample:5,start:25,end:32},{domain:1,sample:6,start:4,end:7},{domain:2,sample:6,start:10,end:17},{domain:3,sample:6,start:20,end:28},{domain:3,sample:6,start:27,end:29},{domain:4,sample:6,start:30,end:34}],e=d3.scale.linear().domain([0,50]).range([0,100]),n=13,a=d3.scale.ordinal().range(["#8dd3c7","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#b15928","#e5c494","#fccde5","#bc80bd","#ccebc5","#ffed6f","#1f78b4"]),r=["sample1","sample2","sample3","sample4","sample5","sample6","sample7","sample8","sample9",,"sample10","sample11","sample12","sample13"],t=(E.selectAll(".domain-line").data(r).enter().append("line").attr("x1",Z+338).attr("x2",Z+670).attr("y1",function(t,e){return 12+e*(n+2)}).attr("y2",function(t,e){return 12+e*(n+2)}).style("stroke-width","2px").style("stroke","lightgrey"),E.selectAll(".domain-ellipse").data(t).enter().append("ellipse").attr("cx",function(t){return Z+350+(t.domain-1)*(e(t.start)+e(t.end)/2)}).attr("cy",function(t){return 10+(t.sample-1)*(n+2)}).attr("rx",function(t){return e(t.end)-e(t.start)}).attr("ry",7).style("fill",function(t){return a(t.domain)}),[{domain:3,sample:1,start:25,end:30,value:0},{domain:4,sample:1,start:35,end:40,value:0},{domain:3,sample:2,start:18,end:24,value:130.23},{domain:3,sample:2,start:25,end:27,value:300.23},{domain:3,sample:3,start:20,end:25,value:90.23},{domain:3,sample:3,start:27,end:29,value:70.23},{domain:4,sample:3,start:30,end:40,value:530.23},{domain:3,sample:4,start:25,end:30,value:0},{domain:4,sample:4,start:35,end:40,value:0},{domain:3,sample:5,start:18,end:24,value:130.23},{domain:3,sample:5,start:25,end:27,value:300.23},{domain:2,sample:5,start:7,end:19,value:330.23},{domain:3,sample:6,start:20,end:25,value:90.23},{domain:3,sample:6,start:27,end:29,value:70.23},{domain:4,sample:6,start:30,end:40,value:530.23},{domain:3,sample:7,start:25,end:30,value:0},{domain:4,sample:7,start:35,end:40,value:0},{domain:3,sample:7,start:18,end:24,value:130.23},{domain:3,sample:7,start:25,end:27,value:300.23},{domain:3,sample:8,start:20,end:25,value:90.23},{domain:3,sample:8,start:27,end:29,value:70.23},{domain:4,sample:8,start:30,end:40,value:530.23},{domain:3,sample:8,start:25,end:30,value:0},{domain:4,sample:8,start:35,end:40,value:0},{domain:3,sample:9,start:18,end:24,value:130.23},{domain:3,sample:9,start:25,end:27,value:300.23},{domain:3,sample:9,start:20,end:25,value:90.23},{domain:3,sample:9,start:27,end:29,value:70.23},{domain:4,sample:9,start:30,end:40,value:530.23},{domain:1,sample:10,start:0,end:6,value:730.23},{domain:2,sample:10,start:10,end:19,value:200.23},{domain:3,sample:10,start:20,end:28,value:0},{domain:4,sample:10,start:24,end:36,value:0},{domain:3,sample:11,start:25,end:30,value:0},{domain:4,sample:11,start:35,end:40,value:0},{domain:3,sample:7,start:25,end:30,value:0},{domain:4,sample:7,start:35,end:40,value:0},{domain:3,sample:7,start:18,end:24,value:130.23},{domain:3,sample:7,start:25,end:27,value:300.23},{domain:3,sample:8,start:20,end:25,value:90.23},{domain:3,sample:8,start:27,end:29,value:70.23},{domain:4,sample:8,start:30,end:40,value:530.23},{domain:3,sample:8,start:25,end:30,value:0},{domain:4,sample:8,start:35,end:40,value:0},{domain:3,sample:9,start:18,end:24,value:130.23},{domain:3,sample:9,start:25,end:27,value:300.23},{domain:3,sample:9,start:20,end:25,value:90.23},{domain:3,sample:9,start:27,end:29,value:70.23},{domain:4,sample:9,start:30,end:40,value:530.23},{domain:1,sample:10,start:0,end:6,value:730.23},{domain:2,sample:10,start:10,end:19,value:200.23},{domain:3,sample:10,start:20,end:28,value:0},{domain:4,sample:10,start:24,end:36,value:0},{domain:3,sample:11,start:25,end:30,value:0},{domain:4,sample:11,start:35,end:40,value:0}]);E.selectAll(".domain-rect").data(t).enter().append("rect").attr("x",function(t){return Z+350+(t.domain-1)*e(t.start)}).attr("y",function(t){return 7+(t.sample-1)*(n+2)}).attr("width",function(t){return e(t.end)-e(t.start)}).attr("height",n).style("fill",function(t){return a(t.domain)}).style("opacity","0.8")}function m(t){var e=d3.nest().key(function(t){return t.Name}).map(t),n=d3.scale.linear().range([0,70]);n.domain([0,d3.max(t,function(t,e){return t.value})]),W=0==W?Z+35:Z+90,V=E.append("g").selectAll("rect").data(w.filter(function(t){return!t.children})).enter().append("rect").attr("x",W).attr("y",-5).attr("width",function(t,a){return n(e[t.name][0].value)}).attr("height",10).attr("transform",function(t){return"translate(240,"+t.x+")"}).style("fill","#EACE3F")}function p(t,e,n,a){return"M"+e+","+t+"V"+n+"H"+a}function f(t,e,n,a){var r=Math.cos(t=(t-90)/180*Math.PI),l=Math.sin(t),i=Math.cos(n=(n-90)/180*Math.PI),s=Math.sin(n);return"M"+e*r+","+e*l+(n===t?"":"A"+e+","+e+" 0 0 "+(n>t?1:0)+" "+e*i+","+e*s)+"L"+a*i+","+a*s}function h(){function t(t,a){var r=t.source,l=t.target,i=((r.x+l.x)/2,(r.y+l.y)/2,[r,{x:l.x,y:r.y},l]);return i=i.map(e),n(i)}var e=function(t){return[t.y+L/2,t.x+D/2]},n=function(t){return"M"+t[0]+ +t[1]+" "+t[2]};return t.projection=function(n){return arguments.length?(e=n,t):e},t.path=function(e){return arguments.length?(n=e,t):n},t}function g(t){return t.length+(t.children?d3.max(t.children,g):0)}function y(t,e,n){t.radius=(e+=t.length)*n,t.children&&t.children.forEach(function(t){y(t,e,n)})}function v(t){for(var e=[],n={},a=t.split(/\s*(;|\(|\)|,|:)\s*/),r=0;r<a.length;r++){var l=a[r];switch(l){case"(":var i={};n.branchset=[i],e.push(n),n=i;break;case",":var i={};e[e.length-1].branchset.push(i),n=i;break;case")":n=e.pop();break;case":":break;default:var s=a[r-1];")"==s||"("==s||","==s?n.name=l:":"==s&&(n.length=parseFloat(l))}}return n}function x(){E.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function b(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),console.log(T);var n=T;t.parent&&n.branchset.forEach(function(e){t==e&&k(e)}),e(n)}function k(t){t.branchset&&(t._children=t.branchset,t._children.forEach(k),t.branchset=null)}function A(){var t;t=document.querySelector("#dendogram svg");var e=(new XMLSerializer).serializeToString(t),n=document.createElement("canvas"),a=n.getContext("2d");n.height=L,n.width=D;var r="";r="data:image/svg+xml;base64,"+btoa(e);var l=document.createElement("img");l.onload=function(){a.drawImage(l,0,0);var t=document.createElement("a");t.download="Dendogram.png",t.href=n.toDataURL("image/png"),document.querySelector("body").appendChild(t),t.click(),document.querySelector("body").removeChild(t)},l.src=r}var T,w,M,E,z,S,D,L,N,I,R,P,_,q,C,V,B,H,F,O,j,G,U,X,Y,J,K,Q={weightLinks:!1,linkValue:!1,linkName:!1,nodeSize:!1,legend:!1,noLinkExtend:!1,treeType:"linear",nodeShape:"",subTree:!1,collapseTree:!1},W=0,Z=0,$=d3.scale.category20b(),tt=["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],et=d3.scale.quantile().range(tt),nt=tt.length,at=d3.scale.linear().domain([0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]).range([1,2,3,4,4.5,5,5.5,6,6.5,7,7.5]).interpolate(d3.interpolateRound),rt=(h(),d3.behavior.zoom().scaleExtent([.1,5]).on("zoom",x)),lt=[1],it=function(t,e){e.branchset&&e.branchset.length>0&&(lt.length<=t+1&&lt.push(0),lt[t+1]+=e.branchset.length,e.branchset.forEach(function(e){it(t+1,e)}))};return d3.select("#saveDendogram").on("click",A),d3.select(self.frameElement).style("height",L+"px"),t.height=function(t){return argument.length?(L=t,this):L},t.width=function(t){return argument.length?(D=t,this):D},t.option=function(t){return arguments.length?(Q=t,this):Q},t.barData=function(t){return arguments.length?(_=t,this):_},t.heatData=function(t){return arguments.length?(q=t,this):q},t.pieData=function(t){return arguments.length?(C=t,this):C},t.domainData=function(t){return arguments.length?(B=t,this):B},t.geneData=function(t){return arguments.length?(H=t,this):H},t.addSun=function(t){return arguments.length?(F=t,this):F},t};